<!DOCTYPE html>
<html>
  <head>
  	<title>Community Dashboard</title>
  	<link href='http://fonts.googleapis.com/css?family=Roboto:400,500,700' rel='stylesheet' type='text/css'>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  	<script src="bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
	<script src="js/eventjoy.storage.js"></script>
	<script type="text/javascript" src="lib/eventjoy.js"></script>
  	
    <!-- Stylesheet main-->
    <link rel="stylesheet" type="text/css" href="css/main-css.css">
    
    <script>
    var showing = false;
    function showSettings(){
      if(!showing){
        $('settings-view').removeClass('hidden');
        $('settings-view').addClass('showing');
        showing = true;
      }else{
        $('settings-view').removeClass('showing');
        $('settings-view').addClass('hidden');
        showing = false;
      }
    }
  </script>
  
    <!-- Polymer import -->
    <link rel="import" href="bower_components/polymer/polymer.html">

  	<!-- Eventjoy Defined Polymer Dom Elements -->
    <link rel="import" href="eventjoy-dom-elements/main-card.html">
    <link rel="import" href="eventjoy-dom-elements/secondary-card.html">
    <link rel="import" href="eventjoy-dom-elements/event-footer.html">
    <link rel="import" href="eventjoy-dom-elements/settings-view.html">

  </head>
  <body>
    <div id="main-content">
    	<!-- This is where we want to define values dynamically -->
      <div id="main-card-wrapper">
      		  <main-card></main-card>
      </div>

    	<div id="recent-activity">
        <p>RECENT ACTIVITY</p>
      </div>

      <div id="secondary-card-wrapper" >
          <secondary-card></secondary-card>
          <secondary-card></secondary-card>
          <secondary-card></secondary-card>
          <secondary-card></secondary-card>
      </div>
      
        <div id="footer-wrapper">
    	       <!-- Footer element -->
      	     <event-footer revenue='35,0000'  attendees='3,500'/>
        </div>
    </div>

    <!-- Settings view which is initially hidden -->
    <settings-view class="hidden"></settings-view>
      
    </div>
    <script type="text/javascript">
    	eventjoy.setApiKey('64e86dc7f5f6e99874d53229601f2bef4653');
		localStorage.setItem('eventjoy_oauth_token', 'nKw0aWOyH8elGZntjbh79VWRbsoXImTIuohEghi1MD1LXQg++oRa8JnEWaxwkW7U9OlpyRfSb0YeRh6EOr7F0wwA4IhYgUCIp+2mF1leO3/DvIjAN6PeWoTu79BWM4VG')	;

					if ( localStorage.getItem( 'eventjoy_access_token' ) ) {
				// We aleady have an access token
				console.log('found access token: '+localStorage.getItem('eventjoy_access_token'));
				eventjoy.setAccessToken( localStorage.getItem('eventjoy_access_token') );
			} else if ( localStorage.getItem( 'eventjoy_oauth_token' ) ) {
				// No, but we we do have a oauth request token
				console.log('found oauth token: '+localStorage.getItem('eventjoy_oauth_token'));
				eventjoy.auth( localStorage.getItem('eventjoy_oauth_token'), function(success, response) {
					localStorage.setItem( 'eventjoy_access_token', response.access_token);
				});
			}
			
			initialiseDB();

				// $("#footer-wrapper").html("<event-footer revenue='50' attendees='100'/>");

		eventjoy.events_orders(622739, {"page[number]": 1, "page[size]" : -1}, function(success, orders) {
			if ( success && orders ) {
				// fetchOrdersDiv.innerHTML = JSON.stringify(orders, null, 2);
				window.store.clearOrders();
				// do {
					orders.data.forEach( function(order) {
						window.store.addOrder(order);
					});
				// } while(orders.links.next) 
				// console.log(orders.links.next);
			}
			// window.store.getOrders("prev", 5, "2014-12-16T10:45:42.000Z", function( status, orders ) {
			// // window.store.getOrders("prev", 5, "2015-02-17T06:19:55.000Z", function( status, orders ) {
			// // window.store.getOrders("prev", 5, "", function( status, orders ) {
			// 	console.log(orders);
			// });
			window.store.getTotalRevenue(function( status, totalRevenue ) {
				// $("#footer-wrapper").html("<event-footer revenue='50' attendees='" + totalRevenue + "'/>");
				window.store.getTotalAttendees(function( status, totalAttendees ) {
					// $("#footer-wrapper").html("<event-footer revenue='" + totalRevenue + "' attendees='" + totalAttendees + "'/>");
					var footer = $("event-footer");
					footer.attr("revenue", totalRevenue);
					footer.attr("attendees", totalAttendees);
					console.log("Total Attendees: " + totalAttendees);
				});
				console.log("Total Revenue: " + totalRevenue);
			});
		});
    </script>
  </body>
</html>